<!DOCTYPE html>
<html>
    <head>
        <title>AniShelter</title>
        <% include ./parts/opt/head.ejs%>
    </head>
    <body>
    <% include ./parts/menu.ejs%>

        <div id="form-main" class="column" style="width: 350px; margin: auto">
            <div class="ui error message transition hidden">
                <i class="close icon"></i>
                <div class="header">
                    password or phone invalid!
                </div>
                <ul class="list">
                    <li>You must include both a upper and lower case letters in your password.</li>
                </ul>
            </div>
                <form class="ui form" method="post">

                    <div class="field">
                            <label>Email</label>
                            <input name="email" type="text" maxlength="25" placeholder="email">
                        </div>
                        <div class="field">
                            <label>Password</label>
                            <input name ="password" type="password" maxlength="35" placeholder="Password">
                        </div>
                            <button class="ui submit button" id="button" type="button" name="button">Sign-in</button>
                    </form>
        </div>
        <script>
                $(document).ready(function(){
                    $('.ui.form').form(
                        {
                            inline : true,
                            on     : 'blur',
                            fields: {
                                email: {
                                    identifier  : 'email', rules: [{type   : 'empty', prompt : 'field email is empty'}, {type   : 'email', prompt : 'email error'}],
                                },
                                password: {
                                    identifier  : 'password', rules: [{type   : 'empty', prompt : 'field password is empty'}, {type   : 'maxLength[35]', prompt : 'Max 35 symbols'}],
                                }
                            },
                            onFailure: function()
                            {
                                console.log('failed');
                                return false;
                            },
                            onSuccess: function(event, fields)
                            {
                                console.log(event);
                                console.log(fields);
                                $.ajax({
                                    url: 'http://185.77.205.82:3000/check', // url where to submit the request
                                    type : "POST", // type of action POST || GET
                                    contentType: 'application/json',
                                    data : JSON.stringify({ 'email':fields.email, 'password':fields.password}),
                                    success: function (data) {
                                        console.log('data',data)
                                        if(data.err === 204){
                                            console.log('account not found')
                                            $("#form-main").find('.ui.error.message.transition.hidden').removeClass('transition').removeClass('hidden');
                                      }else{
                                            window.location = data.redirectUrl;
                                        }
                                    },
                                    error: function(xhr, status, error) {
                                        console.log('error')
                                        console.log(xhr.responseText + '|\n' + status + '|\n' +error);
                                    }
                                });
                                return false;
                            }
                        },
                    );
                    $(".close.icon").on('click',function(){
                        $("#form-main").find('.ui.error.message').addClass('transition').addClass('hidden');
                    });
                });
            
            </script>
        
    </body>
</html>